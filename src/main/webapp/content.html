<!DOCTYPE html>
<head>
    <title></title>
    <script language="JavaScript" type="text/javascript" src="assets/js/richtext.js"></script>
</head>
<body>
<input type="button" id="btnGenerate" value="Populate DropDownList" onclick="PopulateDropDownList()" />
<hr />
<select id="ddlCustomers">
</select>
<script type="text/javascript">
    async function PopulateDropDownList() {
        //Build an array containing Customer records.

        let response = await fetch('api/content/filelist', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json;charset=utf-8'
                },
            }
        );

        let temp = (await response.text()).valueOf();
        console.log(response);
        console.log(temp);

        var filelist = JSON.parse(temp);


        var ddlCustomers = document.getElementById("ddlCustomers");

        //Add the Options to the DropDownList.
        for (var i = 0; i < filelist.length; i++) {
            var option = document.createElement("OPTION");

            //Set Customer Name in Text part.
            //option.innerHTML = customers[i].Name;

            //Set CustomerId in Value part.
            option.innerHTML = filelist[i];


            //Add the Option element to DropDownList.
            ddlCustomers.options.add(option);
        }

        console.log(ddlCustomers.options[ddlCustomers.selectedIndex].text);
    }

    async function openhtml() {
        var html = document.getElementById("ddlCustomers");
        var result = html.options[html.selectedIndex].text;
        let response = await fetch('api/content/html', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain;charset=utf-8'
                }
                , body:result
            }
            )
        ;
        let temp = (await response.text()).valueOf();
        console.log(response);
        console.log(temp);
        var templateData = JSON.parse(temp);
        var templateJson = templateData["root"];
        console.log(templateData["root"]);
        var br = document.createElement("br");
        var form = document.createElement("form");
        form.setAttribute("id","form");
        var countKey = Object.keys(templateJson.Element).length;
        if(!(Array.isArray(templateJson.Element))){
                console.log(templateJson.Element.name);
                var FN = document.createElement("input");
                FN.setAttribute("type", "text");
                FN.setAttribute("name", templateJson.Element.name);
                FN.setAttribute("placeholder", templateJson.Element.name);
                FN.setAttribute("id", "mytextarea");
                form.appendChild(FN);
                form.appendChild(br.cloneNode());
        }
        else {
            console.log(templateJson.Element[0].name);
            for (var i = 0; i < countKey; i++) {
                var FN = document.createElement("input");
                FN.setAttribute("type", "text");
                FN.setAttribute("name", templateJson.Element[i].name);
                FN.setAttribute("placeholder", templateJson.Element[i].name);
                FN.setAttribute("id", "mytextarea");
                form.appendChild(FN);
                form.appendChild(br.cloneNode());
            }
        }
        var s = document.createElement("input");
        s.setAttribute("type", "submit");
        s.setAttribute("value", "Submit");
        form.appendChild(s);
        s.addEventListener("click", function () {
            send();
        });
        var title = document.createElement("input");
        title.setAttribute("type","input");
        title.setAttribute("id","title");
        form.appendChild(title);
        document.getElementsByTagName("body")[0]
            .appendChild(form);



    }
</script>
<script src="assets/js/sendContentData.js"></script>
<input type="submit" value="Submit" onclick="openhtml()" />
</body>
</html>
